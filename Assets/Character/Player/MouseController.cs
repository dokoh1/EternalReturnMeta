// ═══════════════════════════════════════════════════════════════════════════════════════════════════════
// MouseController.cs - 마우스 커서 제어
// ═══════════════════════════════════════════════════════════════════════════════════════════════════════
//
// ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
// │ 개요 (Overview)                                                                                      │
// │                                                                                                       │
// │ 이 파일은 게임 내 마우스 커서의 잠금/해제 상태를 관리합니다.                                          │
// │ MOBA 게임에서 마우스가 화면 밖으로 나가지 않도록 제한합니다.                                         │
// │                                                                                                       │
// │ 핵심 기술:                                                                                            │
// │ 1. Cursor.lockState - Unity의 커서 잠금 모드                                                         │
// │ 2. HasInputAuthority - 로컬 플레이어만 커서 제어                                                     │
// │ 3. CursorLockMode.Confined - 화면 내부에 커서 가두기                                                 │
// └─────────────────────────────────────────────────────────────────────────────────────────────────────┘
//
// ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
// │ 설계 철학 (Design Philosophy)                                                                        │
// │                                                                                                       │
// │ Q: 왜 HasInputAuthority 체크가 필요한가요?                                                           │
// │ A: 멀티플레이어 게임에서 모든 플레이어 오브젝트가 씬에 존재.                                          │
// │    내 캐릭터의 커서만 제어해야 함. 다른 플레이어 커서는 그 플레이어 PC에서 관리.                     │
// │    HasInputAuthority = true면 로컬 플레이어 (내 캐릭터)                                               │
// │                                                                                                       │
// │ Q: CursorLockMode.Confined vs Locked 차이는?                                                         │
// │ A: Confined: 화면 내부에서 자유롭게 이동, 밖으로는 못 나감                                           │
// │    Locked: 화면 중앙에 고정, FPS 게임에서 사용                                                       │
// │    MOBA는 마우스로 클릭해야 하므로 Confined 사용                                                     │
// │                                                                                                       │
// │ Q: Esc와 R키를 왜 사용하나요?                                                                        │
// │ A: Esc: 게임 중 메뉴 열기, 커서 자유 이동 필요                                                       │
// │    R: 스킬 R키와 충돌 가능성 있음 (주의: 추후 수정 필요할 수 있음)                                   │
// │    현재는 테스트용으로 R키로 다시 잠금                                                               │
// └─────────────────────────────────────────────────────────────────────────────────────────────────────┘
//
// ═══════════════════════════════════════════════════════════════════════════════════════════════════════

using Fusion;
using UnityEngine;

// ═══════════════════════════════════════════════════════════════════════════════════════════════════════
// MouseController 클래스
// ═══════════════════════════════════════════════════════════════════════════════════════════════════════
//
// 역할:
// - 게임 시작 시 커서를 화면 내부에 가두기 (Confined)
// - Esc 키로 커서 잠금 해제 (메뉴 접근용)
// - R 키로 커서 다시 잠금
//
// 컴포넌트 위치:
// - 플레이어 캐릭터에 부착 (Eva 등)
// - HasInputAuthority로 로컬 플레이어만 동작
//
// 관련 파일:
// - CameraController.cs: 카메라 화면 가장자리 이동 (커서가 가두어져 있어야 동작)
//
// ═══════════════════════════════════════════════════════════════════════════════════════════════════════
public class MouseController : NetworkBehaviour
{
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    // Start() - 초기화
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    //
    // 왜 Spawned()가 아닌 Start()?
    // - 커서 제어는 Unity 기본 기능 (네트워크 무관)
    // - Spawned() 이전에 커서 설정해도 문제없음
    // - Start()로 충분
    //
    // Cursor.lockState = CursorLockMode.Confined:
    // - 커서를 게임 창(또는 전체화면) 내부에 가둠
    // - 화면 가장자리로 이동 가능, 밖으로는 안 나감
    // - MOBA 게임의 표준 동작
    //
    // Cursor.visible = true:
    // - 커서를 보이게 함
    // - FPS 게임은 false로 숨김
    // - MOBA는 클릭해야 하므로 보여야 함
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    private void Start()
    {
        // 로컬 플레이어만 커서 제어
        if (!HasInputAuthority) return;

        Cursor.lockState = CursorLockMode.Confined;
        Cursor.visible = true;
    }

    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    // Update() - 매 프레임 입력 체크
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    private void Update()
    {
        // 로컬 플레이어만 커서 제어
        if (!HasInputAuthority) return;
        LockMouseToScreenEdge();
    }

    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    // LockMouseToScreenEdge() - 커서 잠금/해제 토글
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    //
    // Esc 키 (KeyCode.Escape):
    // - CursorLockMode.None: 잠금 해제, 자유 이동
    // - 게임 메뉴, Alt+Tab 등을 위해
    // - 멀티모니터 환경에서 다른 화면 클릭 가능
    //
    // R 키 (KeyCode.R):
    // - ⚠️ 주의: 스킬 R키와 충돌 가능
    // - 테스트용 키, 추후 변경 필요
    // - 다시 화면 내부에 가둠
    //
    // TODO: R 키 대신 다른 키 또는 UI 버튼으로 변경
    // ═══════════════════════════════════════════════════════════════════════════════════════════════════
    private void LockMouseToScreenEdge()
    {
        // Esc: 커서 잠금 해제
        if (Input.GetKeyDown(KeyCode.Escape))
        {
            Cursor.lockState = CursorLockMode.None;
            Cursor.visible = true;
        }

        // R: 커서 다시 잠금 (테스트용 - 스킬 R과 충돌 주의)
        if (Input.GetKeyDown(KeyCode.R))
        {
            Cursor.lockState = CursorLockMode.Confined;
            Cursor.visible = true;
        }
    }
}
